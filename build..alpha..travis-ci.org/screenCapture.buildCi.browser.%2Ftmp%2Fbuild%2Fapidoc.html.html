<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="http://retrofox.github.com/calendar-tools">calendar-tools (v0.3.9)</a>
</h1>
<h4>Calendar object model</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.calendar-tools">module calendar-tools</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.calendar-tools.recurrence">
            function <span class="apidocSignatureSpan">calendar-tools.</span>recurrence
            <span class="apidocSignatureSpan">(evs, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.calendar-tools.seed">
            function <span class="apidocSignatureSpan">calendar-tools.</span>seed
            <span class="apidocSignatureSpan">(ev, parent, options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">calendar-tools.</span>atom</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">calendar-tools.</span>rfc2445</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">calendar-tools.</span>util</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">calendar-tools.</span>version</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.calendar-tools.atom">module calendar-tools.atom</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.calendar-tools.atom.genEvent">
            function <span class="apidocSignatureSpan">calendar-tools.atom.</span>genEvent
            <span class="apidocSignatureSpan">(ev, opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.calendar-tools.rfc2445">module calendar-tools.rfc2445</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.calendar-tools.rfc2445.genRecurrenceString">
            function <span class="apidocSignatureSpan">calendar-tools.rfc2445.</span>genRecurrenceString
            <span class="apidocSignatureSpan">(ev, opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.calendar-tools.rfc2445.getAllday">
            function <span class="apidocSignatureSpan">calendar-tools.rfc2445.</span>getAllday
            <span class="apidocSignatureSpan">(str)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.calendar-tools.rfc2445.getFrequency">
            function <span class="apidocSignatureSpan">calendar-tools.rfc2445.</span>getFrequency
            <span class="apidocSignatureSpan">(str, namesMap)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.calendar-tools.rfc2445.getRecurrenceObj">
            function <span class="apidocSignatureSpan">calendar-tools.rfc2445.</span>getRecurrenceObj
            <span class="apidocSignatureSpan">(str)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.calendar-tools" id="apidoc.module.calendar-tools">module calendar-tools</a></h1>


    <h2>
        <a href="#apidoc.element.calendar-tools.recurrence" id="apidoc.element.calendar-tools.recurrence">
        function <span class="apidocSignatureSpan">calendar-tools.</span>recurrence
        <span class="apidocSignatureSpan">(evs, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">recurrence = function (evs, options) {
  return new Recurrence(evs, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.calendar-tools.seed" id="apidoc.element.calendar-tools.seed">
        function <span class="apidocSignatureSpan">calendar-tools.</span>seed
        <span class="apidocSignatureSpan">(ev, parent, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">seed = function (ev, parent, options) {
  return new Seed(ev, parent, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>










</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.calendar-tools.atom" id="apidoc.module.calendar-tools.atom">module calendar-tools.atom</a></h1>


    <h2>
        <a href="#apidoc.element.calendar-tools.atom.genEvent" id="apidoc.element.calendar-tools.atom.genEvent">
        function <span class="apidocSignatureSpan">calendar-tools.atom.</span>genEvent
        <span class="apidocSignatureSpan">(ev, opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">genEvent = function (ev, opts) {

  // default options
  opts = opts || {};
  var options = {
          start: ev.start
        , end: ev.end
        , timezone: 'GMT'
        , originalEvent: null
      };

  for (var k in options)
    options[k] = opts[k] || options[k];

  // timezone location
  tz = options.timezone;

  var orgEv = options,originalEvent;

  return [
      '&lt;entry xmlns="http://www.w3.org/2005/Atom" '
    ,        'xmlns:gd="http://schemas.google.com/g/2005" '
    ,        'xmlns:gCal="http://schemas.google.com/gCal/2005" '
    ,        'gd:fields="gd:recurrence,gd:when"&gt;'
    ,   "&lt;title&gt;" + _str.content(ev.title) + "&lt;/title&gt;"

    ,   ev.frequency
          ? "&lt;gd:recurrence&gt;"
              + _str.content(RFC2445.genRecurrenceString(ev, opts))
              + "&lt;/gd:recurrence&gt;"
          : "&lt;gd:when startTime=\""
              + _str.attr(_str.date(options.start, ev.allDay)) + "\" "
              + "endTime=\""
              + _str.attr(_str.date(options.end, ev.allDay, true)) + "\" /&gt;"

    ,   orgEv
          ? "&lt;gd:originalEvent href=\"" + orgEv.href + "\" id=\"" + orgEv.id + "\"&gt;"
              + "&lt;gd:when startTime=\"" + org.Ev.startTime + "\"/&gt;"
              + "&lt;/gd:originalEvent&gt;"
          : ""

    ,   "&lt;gd:where valueString=\"" + _str.attr(tz) + "\"&gt;&lt;/gd:where&gt;"
    ,   ev.isNew
          ? "&lt;published&gt;" + _str.date(new Date) + "&lt;/published&gt;"
          : "&lt;updated&gt;" + _str.date(new Date) + "&lt;/updated&gt;"
    , "&lt;/entry&gt;"
  ].join('');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.calendar-tools.rfc2445" id="apidoc.module.calendar-tools.rfc2445">module calendar-tools.rfc2445</a></h1>


    <h2>
        <a href="#apidoc.element.calendar-tools.rfc2445.genRecurrenceString" id="apidoc.element.calendar-tools.rfc2445.genRecurrenceString">
        function <span class="apidocSignatureSpan">calendar-tools.rfc2445.</span>genRecurrenceString
        <span class="apidocSignatureSpan">(ev, opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">genRecurrenceString = function (ev, opts) {
  if (!ev.frequency) return '';

  opts = opts  || {};

  var options = {
          start: ev.start
        , end: ev.end
        , timezone: 'GMT'
      };

  for (var k in options)
    options[k] = opts[k] || options[k];

  var tz = options.timezone;

  // period: DTSTART, DTEND
  var rules = [
          'DTSTART' + (ev.allDay
                          ? ';' + _str.value(options.start)
                          : ';' + _str.dateTZID(options.start, tz))
        , 'DTEND' + (ev.allDay
                          ? ';' + _str.value(options.end, false, ev.allDay)
                          : ';' + _str.dateTZID(options.end, tz))
      ];

  // RRULE - frequency value
  var rrule = ''
    , steps = ['freq', 'repeat', 'end-by', 'interval']
    , endBy = ''
    , interval = '';

  // end-by type

  // COUNT
  if (ev.recurrence['end-by'].type == 'after')
    endBy = ';COUNT=' + ev.recurrence['end-by'].after;
  // ON
  if (ev.recurrence['end-by'].type == 'on')
    endBy = ';UNTIL=' + _str.value(ev.recurrence['end-by'].on, true, true);

  // INTERVAL
  if (ev.recurrence.every != 1)
    interval = ';INTERVAL=' + ev.recurrence.every;

  for (var st = 0; st &lt; steps.length; st++) {
    if (st == 0 || st == 2) {
      switch (ev.frequency) {
        case 'year':
          rrule += st == 0
                    ? 'RRULE:FREQ=YEARLY'
                    : '';
        break;

        case 'month':
          rrule += st == 0
                    ? 'RRULE:FREQ=MONTHLY'
                    : (st == 2
                        ? (ev.recurrence['repeat-on'].mode == 'day-of-month'
                            ? ';BYMONTHDAY=' + ev.start.getDate()
                            : ';BYDAY=' + (_date.getWeekOfDay(ev.start) + 1)
                              + daysMapRecToRFC2445[dayNames[options.start.getDay()]])
                        : '');
        break;

        case 'week':
          var days = '';
          for (var l in ev.recurrence['repeat-on'])
            days += daysMapRecToRFC2445[l] + ','

          days = days.substring(0, days.length - 1);

          rrule += st == 0
                    ? 'RRULE:FREQ=WEEKLY;BYDAY=' + days
                    : '';
        break;

        case 'day':
          rrule += st == 0
                    ? 'RRULE:FREQ=DAILY'
                    : '';
        break;
      };
    }

    // add end-by
    else if (st == 1)
      rrule += endBy;

    // add end-by
    else if (st == 3)
      rrule += interval;

  };

  rules.push(rrule);

  return rules.join("\r\n");
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.calendar-tools.rfc2445.getAllday" id="apidoc.element.calendar-tools.rfc2445.getAllday">
        function <span class="apidocSignatureSpan">calendar-tools.rfc2445.</span>getAllday
        <span class="apidocSignatureSpan">(str)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getAllday = function (str) {
  // debug: get all-day property from RFC2445 \x1B[0;33m%s\x1B[0m, str
  // deduces 'all-day' property through the DTSTART format property
  var dtstart = str.match(/(^DTSTART;([^ ]+))(:\w+)(T)/);

  return dtstart ? false : true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.calendar-tools.rfc2445.getFrequency" id="apidoc.element.calendar-tools.rfc2445.getFrequency">
        function <span class="apidocSignatureSpan">calendar-tools.rfc2445.</span>getFrequency
        <span class="apidocSignatureSpan">(str, namesMap)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getFrequency = function (str, namesMap) {
  // debug: get frequency property from RFC2445 \x1B[0;33m%s\x1B[0m, str
  // frequency names map
  namesMap = namesMap || freqNamesMap;

  var frequency = str.match(/FREQ=([A-Z]+)/);

  if (frequency)
    return namesMap[frequency[1]];
  return null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.calendar-tools.rfc2445.getRecurrenceObj" id="apidoc.element.calendar-tools.rfc2445.getRecurrenceObj">
        function <span class="apidocSignatureSpan">calendar-tools.rfc2445.</span>getRecurrenceObj
        <span class="apidocSignatureSpan">(str)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getRecurrenceObj = function (str) {
  // debug: RFC2445 \x1B[0;33m%s\x1B[0m string to recurrence object, str
  var recRule = str.match(/RRULE(.+)/)
    , recObj = {
          every: 1
        , 'end-by': {}
        , exceptions: []
        , 'repeat-on': {}
      }
    , _freq = '';

  recRule = recRule.length ? recRule[0] : null;

  if (!recRule) return null;

  // debug: recurrence rule \x1B[0;33m%s\x1B[0m, recRule
  var recPrpsRule = recRule.split(';');

  for (var k = 0; k &lt; recPrpsRule.length; k++) {
    var prp = recPrpsRule[k].split('=');
    // debug: recurrence property [%s]: \x1B[0;33m%s: %j\x1B[0m, k, prp[0], prp[1]

    // recurrence type
    if (prp[0] == 'RRULE:FREQ') {
      _freq = prp[1];
    }

    // INTERVAL/repeat
    if (prp[0] == 'INTERVAL') {
      recObj.every = prp[1];
    }

    // end-by properties
    // AFTER mode
    else if (prp[0] == 'COUNT') {
      recObj['end-by'].type = 'after';
      recObj['end-by'].after = prp[1];
    }

    // UNTIL/on mode
    else if (prp[0] == 'UNTIL') {
      recObj['end-by'].type = 'on';
      var data = _date.parseFromWeirdISOFormat(prp[1]);
      recObj['end-by'].on = new Date(data);

    }

    // BYDAY/repeat-on. Used for:
    // - weekly mode
    // - monthly mode - day on week
    else if (prp[0] == 'BYDAY') {

      if (_freq == 'WEEKLY') {
        var days = prp[1].split(',');
        for (var l = 0; l &lt; days.length; l++) {
          var key = daysMapRFC2445toRec[days[l]];
          recObj['repeat-on'][key] = 'on';
        };
      }
      else if (_freq == 'MONTHLY') {
        // for monthly trecurrence type simply defines mode
        recObj['repeat-on'].mode = 'day-of-week';

      }
    }

    // BYMONTHDAY/repeat-on. Used for:
    // - monthly mode
    else if (prp[0] == 'BYMONTHDAY')
      recObj['repeat-on'].mode = 'day-of-month';

  };

  // setting default options
  // end-by type
  recObj['end-by'].type = recObj['end-by'].type || 'never';

  return recObj;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>