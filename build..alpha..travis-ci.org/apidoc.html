<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="http://retrofox.github.com/calendar-tools"

    >calendar-tools (v0.3.9)</a>
</h1>
<h4>Calendar object model</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.calendar-tools">module calendar-tools</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.calendar-tools.recurrence">
            function <span class="apidocSignatureSpan">calendar-tools.</span>recurrence
            <span class="apidocSignatureSpan">(evs, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.calendar-tools.seed">
            function <span class="apidocSignatureSpan">calendar-tools.</span>seed
            <span class="apidocSignatureSpan">(ev, parent, options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">calendar-tools.</span>atom</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">calendar-tools.</span>rfc2445</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">calendar-tools.</span>util</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">calendar-tools.</span>version</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.calendar-tools.atom">module calendar-tools.atom</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.calendar-tools.atom.genEvent">
            function <span class="apidocSignatureSpan">calendar-tools.atom.</span>genEvent
            <span class="apidocSignatureSpan">(ev, opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.calendar-tools.rfc2445">module calendar-tools.rfc2445</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.calendar-tools.rfc2445.genRecurrenceString">
            function <span class="apidocSignatureSpan">calendar-tools.rfc2445.</span>genRecurrenceString
            <span class="apidocSignatureSpan">(ev, opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.calendar-tools.rfc2445.getAllday">
            function <span class="apidocSignatureSpan">calendar-tools.rfc2445.</span>getAllday
            <span class="apidocSignatureSpan">(str)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.calendar-tools.rfc2445.getFrequency">
            function <span class="apidocSignatureSpan">calendar-tools.rfc2445.</span>getFrequency
            <span class="apidocSignatureSpan">(str, namesMap)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.calendar-tools.rfc2445.getRecurrenceObj">
            function <span class="apidocSignatureSpan">calendar-tools.rfc2445.</span>getRecurrenceObj
            <span class="apidocSignatureSpan">(str)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.calendar-tools" id="apidoc.module.calendar-tools">module calendar-tools</a></h1>


    <h2>
        <a href="#apidoc.element.calendar-tools.recurrence" id="apidoc.element.calendar-tools.recurrence">
        function <span class="apidocSignatureSpan">calendar-tools.</span>recurrence
        <span class="apidocSignatureSpan">(evs, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">recurrence = function (evs, options) {
  return new Recurrence(evs, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.calendar-tools.seed" id="apidoc.element.calendar-tools.seed">
        function <span class="apidocSignatureSpan">calendar-tools.</span>seed
        <span class="apidocSignatureSpan">(ev, parent, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">seed = function (ev, parent, options) {
  return new Seed(ev, parent, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>










</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.calendar-tools.atom" id="apidoc.module.calendar-tools.atom">module calendar-tools.atom</a></h1>


    <h2>
        <a href="#apidoc.element.calendar-tools.atom.genEvent" id="apidoc.element.calendar-tools.atom.genEvent">
        function <span class="apidocSignatureSpan">calendar-tools.atom.</span>genEvent
        <span class="apidocSignatureSpan">(ev, opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">genEvent = function (ev, opts) {

  // default options
  opts = opts || {};
  var options = {
          start: ev.start
        , end: ev.end
        , timezone: &#x27;GMT&#x27;
        , originalEvent: null
      };

  for (var k in options)
    options[k] = opts[k] || options[k];

  // timezone location
  tz = options.timezone;

  var orgEv = options,originalEvent;

  return [
      &#x27;&#x3c;entry xmlns=&#x22;http://www.w3.org/2005/Atom&#x22; &#x27;
    ,        &#x27;xmlns:gd=&#x22;http://schemas.google.com/g/2005&#x22; &#x27;
    ,        &#x27;xmlns:gCal=&#x22;http://schemas.google.com/gCal/2005&#x22; &#x27;
    ,        &#x27;gd:fields=&#x22;gd:recurrence,gd:when&#x22;&#x3e;&#x27;
    ,   &#x22;&#x3c;title&#x3e;&#x22; + _str.content(ev.title) + &#x22;&#x3c;/title&#x3e;&#x22;

    ,   ev.frequency
          ? &#x22;&#x3c;gd:recurrence&#x3e;&#x22;
              + _str.content(RFC2445.genRecurrenceString(ev, opts))
              + &#x22;&#x3c;/gd:recurrence&#x3e;&#x22;
          : &#x22;&#x3c;gd:when startTime=\&#x22;&#x22;
              + _str.attr(_str.date(options.start, ev.allDay)) + &#x22;\&#x22; &#x22;
              + &#x22;endTime=\&#x22;&#x22;
              + _str.attr(_str.date(options.end, ev.allDay, true)) + &#x22;\&#x22; /&#x3e;&#x22;

    ,   orgEv
          ? &#x22;&#x3c;gd:originalEvent href=\&#x22;&#x22; + orgEv.href + &#x22;\&#x22; id=\&#x22;&#x22; + orgEv.id + &#x22;\&#x22;&#x3e;&#x22;
              + &#x22;&#x3c;gd:when startTime=\&#x22;&#x22; + org.Ev.startTime + &#x22;\&#x22;/&#x3e;&#x22;
              + &#x22;&#x3c;/gd:originalEvent&#x3e;&#x22;
          : &#x22;&#x22;

    ,   &#x22;&#x3c;gd:where valueString=\&#x22;&#x22; + _str.attr(tz) + &#x22;\&#x22;&#x3e;&#x3c;/gd:where&#x3e;&#x22;
    ,   ev.isNew
          ? &#x22;&#x3c;published&#x3e;&#x22; + _str.date(new Date) + &#x22;&#x3c;/published&#x3e;&#x22;
          : &#x22;&#x3c;updated&#x3e;&#x22; + _str.date(new Date) + &#x22;&#x3c;/updated&#x3e;&#x22;
    , &#x22;&#x3c;/entry&#x3e;&#x22;
  ].join(&#x27;&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.calendar-tools.rfc2445" id="apidoc.module.calendar-tools.rfc2445">module calendar-tools.rfc2445</a></h1>


    <h2>
        <a href="#apidoc.element.calendar-tools.rfc2445.genRecurrenceString" id="apidoc.element.calendar-tools.rfc2445.genRecurrenceString">
        function <span class="apidocSignatureSpan">calendar-tools.rfc2445.</span>genRecurrenceString
        <span class="apidocSignatureSpan">(ev, opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">genRecurrenceString = function (ev, opts) {
  if (!ev.frequency) return &#x27;&#x27;;

  opts = opts  || {};

  var options = {
          start: ev.start
        , end: ev.end
        , timezone: &#x27;GMT&#x27;
      };

  for (var k in options)
    options[k] = opts[k] || options[k];

  var tz = options.timezone;

  // period: DTSTART, DTEND
  var rules = [
          &#x27;DTSTART&#x27; + (ev.allDay
                          ? &#x27;;&#x27; + _str.value(options.start)
                          : &#x27;;&#x27; + _str.dateTZID(options.start, tz))
        , &#x27;DTEND&#x27; + (ev.allDay
                          ? &#x27;;&#x27; + _str.value(options.end, false, ev.allDay)
                          : &#x27;;&#x27; + _str.dateTZID(options.end, tz))
      ];

  // RRULE - frequency value
  var rrule = &#x27;&#x27;
    , steps = [&#x27;freq&#x27;, &#x27;repeat&#x27;, &#x27;end-by&#x27;, &#x27;interval&#x27;]
    , endBy = &#x27;&#x27;
    , interval = &#x27;&#x27;;

  // end-by type

  // COUNT
  if (ev.recurrence[&#x27;end-by&#x27;].type == &#x27;after&#x27;)
    endBy = &#x27;;COUNT=&#x27; + ev.recurrence[&#x27;end-by&#x27;].after;
  // ON
  if (ev.recurrence[&#x27;end-by&#x27;].type == &#x27;on&#x27;)
    endBy = &#x27;;UNTIL=&#x27; + _str.value(ev.recurrence[&#x27;end-by&#x27;].on, true, true);

  // INTERVAL
  if (ev.recurrence.every != 1)
    interval = &#x27;;INTERVAL=&#x27; + ev.recurrence.every;

  for (var st = 0; st &#x3c; steps.length; st++) {
    if (st == 0 || st == 2) {
      switch (ev.frequency) {
        case &#x27;year&#x27;:
          rrule += st == 0
                    ? &#x27;RRULE:FREQ=YEARLY&#x27;
                    : &#x27;&#x27;;
        break;

        case &#x27;month&#x27;:
          rrule += st == 0
                    ? &#x27;RRULE:FREQ=MONTHLY&#x27;
                    : (st == 2
                        ? (ev.recurrence[&#x27;repeat-on&#x27;].mode == &#x27;day-of-month&#x27;
                            ? &#x27;;BYMONTHDAY=&#x27; + ev.start.getDate()
                            : &#x27;;BYDAY=&#x27; + (_date.getWeekOfDay(ev.start) + 1)
                              + daysMapRecToRFC2445[dayNames[options.start.getDay()]])
                        : &#x27;&#x27;);
        break;

        case &#x27;week&#x27;:
          var days = &#x27;&#x27;;
          for (var l in ev.recurrence[&#x27;repeat-on&#x27;])
            days += daysMapRecToRFC2445[l] + &#x27;,&#x27;

          days = days.substring(0, days.length - 1);

          rrule += st == 0
                    ? &#x27;RRULE:FREQ=WEEKLY;BYDAY=&#x27; + days
                    : &#x27;&#x27;;
        break;

        case &#x27;day&#x27;:
          rrule += st == 0
                    ? &#x27;RRULE:FREQ=DAILY&#x27;
                    : &#x27;&#x27;;
        break;
      };
    }

    // add end-by
    else if (st == 1)
      rrule += endBy;

    // add end-by
    else if (st == 3)
      rrule += interval;

  };

  rules.push(rrule);

  return rules.join(&#x22;\r\n&#x22;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.calendar-tools.rfc2445.getAllday" id="apidoc.element.calendar-tools.rfc2445.getAllday">
        function <span class="apidocSignatureSpan">calendar-tools.rfc2445.</span>getAllday
        <span class="apidocSignatureSpan">(str)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getAllday = function (str) {
  // debug: get all-day property from RFC2445 \x1B[0;33m%s\x1B[0m, str
  // deduces &#x27;all-day&#x27; property through the DTSTART format property
  var dtstart = str.match(/(^DTSTART;([^ ]+))(:\w+)(T)/);

  return dtstart ? false : true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.calendar-tools.rfc2445.getFrequency" id="apidoc.element.calendar-tools.rfc2445.getFrequency">
        function <span class="apidocSignatureSpan">calendar-tools.rfc2445.</span>getFrequency
        <span class="apidocSignatureSpan">(str, namesMap)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getFrequency = function (str, namesMap) {
  // debug: get frequency property from RFC2445 \x1B[0;33m%s\x1B[0m, str
  // frequency names map
  namesMap = namesMap || freqNamesMap;

  var frequency = str.match(/FREQ=([A-Z]+)/);

  if (frequency)
    return namesMap[frequency[1]];
  return null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.calendar-tools.rfc2445.getRecurrenceObj" id="apidoc.element.calendar-tools.rfc2445.getRecurrenceObj">
        function <span class="apidocSignatureSpan">calendar-tools.rfc2445.</span>getRecurrenceObj
        <span class="apidocSignatureSpan">(str)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getRecurrenceObj = function (str) {
  // debug: RFC2445 \x1B[0;33m%s\x1B[0m string to recurrence object, str
  var recRule = str.match(/RRULE(.+)/)
    , recObj = {
          every: 1
        , &#x27;end-by&#x27;: {}
        , exceptions: []
        , &#x27;repeat-on&#x27;: {}
      }
    , _freq = &#x27;&#x27;;

  recRule = recRule.length ? recRule[0] : null;

  if (!recRule) return null;

  // debug: recurrence rule \x1B[0;33m%s\x1B[0m, recRule
  var recPrpsRule = recRule.split(&#x27;;&#x27;);

  for (var k = 0; k &#x3c; recPrpsRule.length; k++) {
    var prp = recPrpsRule[k].split(&#x27;=&#x27;);
    // debug: recurrence property [%s]: \x1B[0;33m%s: %j\x1B[0m, k, prp[0], prp[1]

    // recurrence type
    if (prp[0] == &#x27;RRULE:FREQ&#x27;) {
      _freq = prp[1];
    }

    // INTERVAL/repeat
    if (prp[0] == &#x27;INTERVAL&#x27;) {
      recObj.every = prp[1];
    }

    // end-by properties
    // AFTER mode
    else if (prp[0] == &#x27;COUNT&#x27;) {
      recObj[&#x27;end-by&#x27;].type = &#x27;after&#x27;;
      recObj[&#x27;end-by&#x27;].after = prp[1];
    }

    // UNTIL/on mode
    else if (prp[0] == &#x27;UNTIL&#x27;) {
      recObj[&#x27;end-by&#x27;].type = &#x27;on&#x27;;
      var data = _date.parseFromWeirdISOFormat(prp[1]);
      recObj[&#x27;end-by&#x27;].on = new Date(data);

    }

    // BYDAY/repeat-on. Used for:
    // - weekly mode
    // - monthly mode - day on week
    else if (prp[0] == &#x27;BYDAY&#x27;) {

      if (_freq == &#x27;WEEKLY&#x27;) {
        var days = prp[1].split(&#x27;,&#x27;);
        for (var l = 0; l &#x3c; days.length; l++) {
          var key = daysMapRFC2445toRec[days[l]];
          recObj[&#x27;repeat-on&#x27;][key] = &#x27;on&#x27;;
        };
      }
      else if (_freq == &#x27;MONTHLY&#x27;) {
        // for monthly trecurrence type simply defines mode
        recObj[&#x27;repeat-on&#x27;].mode = &#x27;day-of-week&#x27;;

      }
    }

    // BYMONTHDAY/repeat-on. Used for:
    // - monthly mode
    else if (prp[0] == &#x27;BYMONTHDAY&#x27;)
      recObj[&#x27;repeat-on&#x27;].mode = &#x27;day-of-month&#x27;;

  };

  // setting default options
  // end-by type
  recObj[&#x27;end-by&#x27;].type = recObj[&#x27;end-by&#x27;].type || &#x27;never&#x27;;

  return recObj;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
